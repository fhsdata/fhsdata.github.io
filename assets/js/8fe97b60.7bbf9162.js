/*! For license information please see 8fe97b60.7bbf9162.js.LICENSE.txt */
"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[13599],{66904:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>n,metadata:()=>o,toc:()=>l});var s=i(24246),a=i(71670);const n={title:"React Native 0.71-RC0 Android outage postmortem",authors:["cortinico","kelset"],tags:["engineering"],date:new Date("2023-01-27T00:00:00.000Z")},r=void 0,o={permalink:"/blog/2023/01/27/71rc1-android-outage-postmortem",source:"@site/blog/2023-01-27-71rc1-android-outage-postmortem.md",title:"React Native 0.71-RC0 Android outage postmortem",description:"Now that 0.71 is available, we want to share some key information about the incident that broke Android builds for all React Native versions while releasing the first 0.71 release candidate for React Native & Expo Android builds on November 4th, 2022.",date:"2023-01-27T00:00:00.000Z",formattedDate:"January 27, 2023",tags:[{label:"engineering",permalink:"/blog/tags/engineering"}],readingTime:6.65,hasTruncateMarker:!0,authors:[{name:"Nicola Corti",title:"Software Engineer at Meta",url:"https://twitter.com/cortinico",imageURL:"https://github.com/cortinico.png",key:"cortinico"},{name:"Lorenzo Sciandra",title:"Senior Software Engineer at Microsoft",url:"https://twitter.com/kelset",imageURL:"https://github.com/kelset.png",key:"kelset"}],frontMatter:{title:"React Native 0.71-RC0 Android outage postmortem",authors:["cortinico","kelset"],tags:["engineering"],date:"2023-01-27T00:00:00.000Z"},unlisted:!1,prevItem:{title:"Package Exports Support in React Native",permalink:"/blog/2023/06/21/package-exports-support"},nextItem:{title:"React Native 0.71: TypeScript by Default, Flexbox Gap, and more...",permalink:"/blog/2023/01/12/version-071"}},c={authorsImageUrls:[void 0,void 0]},l=[{value:"Incident response strategy",id:"incident-response-strategy",level:3},{value:"Release Support Policy",id:"release-support-policy",level:3},{value:"Improved testing and best practices for 3rd party libraries",id:"improved-testing-and-best-practices-for-3rd-party-libraries",level:3}];function d(e){const t=Object.assign({p:"p",a:"a",h1:"h1",code:"code",em:"em",ul:"ul",li:"li",h3:"h3"},(0,a.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["Now that 0.71 is ",(0,s.jsx)(t.a,{href:"/blog/2023/01/12/version-071",children:"available"}),", we want to share some key information about the incident that broke Android builds for all React Native versions while releasing the first 0.71 release candidate for React Native & Expo Android builds on November 4th, 2022."]}),"\n",(0,s.jsx)(t.p,{children:"The contributors who helped tackle the incident recently attended a post-mortem meeting to discuss in detail what happened, what we all learned from it, and what actions we are going to take to avoid similar outages in the future."}),"\n",(0,s.jsx)(t.h1,{id:"what-happened",children:"What happened"}),"\n",(0,s.jsxs)(t.p,{children:["On November 4th 2022, we published the version ",(0,s.jsx)(t.code,{children:"0.71.0-rc0"})," of React Native, the first release candidate for 0.71, on several public repositories."]}),"\n",(0,s.jsxs)(t.p,{children:["A major change made in this release candidate helped to improve build times by publishing artifacts to Maven Central, instead of building them from source. More details on how this was done are available in ",(0,s.jsx)(t.a,{href:"https://github.com/react-native-community/discussions-and-proposals/pull/508",children:"RFC#508"})," and ",(0,s.jsx)(t.a,{href:"https://github.com/reactwg/react-native-new-architecture/discussions/105",children:"related discussions"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Unfortunately, because of the way we scaffolded new projects from the template, this caused build failures for any Android user on older versions because they would start downloading new artifacts for ",(0,s.jsx)(t.code,{children:"0.71.0-rc0"})," instead of the version they were using in their project (like ",(0,s.jsx)(t.code,{children:"0.68.0"}),")."]}),"\n",(0,s.jsx)(t.h1,{id:"why-this-happened",children:"Why this happened"}),"\n",(0,s.jsxs)(t.p,{children:["The React Native template provides a ",(0,s.jsx)(t.code,{children:"build.gradle"})," file to build Android apps. This file contains a dependency on the React Native Android library as follows:\n",(0,s.jsx)(t.code,{children:'implementation("com.facebook.react:react-native:+")'}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Importantly, the ",(0,s.jsx)(t.code,{children:"+"})," part of this dependency (a ",(0,s.jsx)(t.a,{href:"https://docs.gradle.org/current/userguide/dynamic_versions.html",children:"Gradle Dynamic version"}),") tells Gradle to pick the highest available version of React Native. Using Gradle Dynamic versions is considered an antipattern as it exposes users to less-reproducible builds."]}),"\n",(0,s.jsxs)(t.p,{children:["We were aware of the issues dynamic versions could cause, so in ",(0,s.jsx)(t.code,{children:"0.71"})," we cleaned up the new app template and removed all the ",(0,s.jsx)(t.code,{children:"+"})," dependencies. However, users on older versions of React Native were still using a ",(0,s.jsx)(t.code,{children:"+"})," version."]}),"\n",(0,s.jsxs)(t.p,{children:["This caused builds with React Native versions before ",(0,s.jsx)(t.code,{children:"0.71.0-rc.0"})," to query all the repositories for the highest available versions of the React Native. Because the newly pushed 0.71.0-rc.0 on Maven Central became the highest version available, builds with React Native versions before 0.71.0-rc.0 started using artifacts from 0.71.0-rc.0. The React Native version mismatch between the local build (e.g ",(0,s.jsx)(t.code,{children:"0.68.0"}),") and artifacts from Maven Central (",(0,s.jsx)(t.code,{children:"0.71.0-rc.0"}),") caused these builds to fail."]}),"\n",(0,s.jsxs)(t.p,{children:["Further technical details on this event area are also available ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/issues/35210",children:"on this GitHub issue"}),"."]}),"\n",(0,s.jsx)(t.h1,{id:"how-we-mitigated--resolved",children:"How we mitigated & resolved"}),"\n",(0,s.jsx)(t.p,{children:"As soon as we identified the issue on November 4th, the community found and shared a manual workaround to fix the issue which would pin React Native to a specific, correcting the mistake."}),"\n",(0,s.jsx)(t.p,{children:"Then, over the weekend of November 5th and 6th, the release crew shipped patch releases for all previous React Native versions down to 0.63 which automatically applied the patch, so that users could update to a fixed version of React Native."}),"\n",(0,s.jsxs)(t.p,{children:["At the same time, we ",(0,s.jsx)(t.a,{href:"https://issues.sonatype.org/browse/OSSRH-86006",children:"reached out to Sonatype"})," to ask for the removal of the offending artifacts."]}),"\n",(0,s.jsx)(t.p,{children:"The issue was fully resolved on November 8th when the artifacts were fully removed from Maven Central."}),"\n",(0,s.jsx)(t.h1,{id:"timeline-of-events",children:"Timeline of events"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:"This section contains a brief timeline of the events. All times are GMT/UTC +0"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Nov 4th - 5:06 PM: ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/releases/tag/v0.71.0-rc.0",children:"0.71-RC0 is released"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Nov 4th - 6:20 PM: ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/issues/35204",children:"First report of build issue is opened"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Nov 4th - 7:45 PM: ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/issues/35204#issuecomment-1304090948",children:"Issue is identified by community"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Nov 4th - 9:39 PM: ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/issues/35204#issuecomment-1304281740",children:"Workarounds are communicated, Expo "}),"deploys fix to all their users."]}),"\n",(0,s.jsxs)(t.li,{children:["Nov 5th - 03:04 AM: ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/issues/35210",children:"New issue is open to communicate status and workarounds"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Nov 6th - 04:11 PM: ",(0,s.jsx)(t.a,{href:"https://issues.sonatype.org/browse/OSSRH-86006?focusedCommentId=1216303&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-1216303",children:"Ticket to SonaType"})," asking for removal of the artifacts is open."]}),"\n",(0,s.jsxs)(t.li,{children:["Nov 6th - 04:40 PM: ",(0,s.jsx)(t.a,{href:"https://twitter.com/reactnative/status/1589296764678705155",children:"First tweet"})," from @reactnative with ack + link to issue."]}),"\n",(0,s.jsx)(t.li,{children:"Nov 6th - 07:05 PM: Decision to patch React Native versions back to 0.63."}),"\n",(0,s.jsxs)(t.li,{children:["Nov 7th - 12:47 AM: Last patched release is released: ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/releases/tag/v0.63.5",children:"0.63.5"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Nov 8th - 08:04 PM: Artifacts on Maven Central are ",(0,s.jsx)(t.a,{href:"https://issues.sonatype.org/browse/OSSRH-86006?focusedCommentId=1216303&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-1216303",children:"fully removed"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Nov 10th - 11:51 AM: Issue about the ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/issues/35210#issuecomment-1310170361",children:"incident is closed"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.h1,{id:"lessons-learned",children:"Lessons Learned"}),"\n",(0,s.jsx)(t.p,{children:"While in many ways the conditions to trigger this incident has existed since React Native 0.12.0, we want to ensure that the foundations on which we develop and release React Native moving forward are stronger. Here are some of the lessons learned and the actionables on how we\u2019ll adapt our processes and infrastructure to respond faster and stronger in the future."}),"\n",(0,s.jsx)(t.h3,{id:"incident-response-strategy",children:"Incident response strategy"}),"\n",(0,s.jsx)(t.p,{children:"This incident highlighted gaps in our incident response strategy for open-source issues related to React Native."}),"\n",(0,s.jsx)(t.p,{children:"The community quickly found a workaround in less than 2 hours. Due to our lack of visibility on the scope of the impact of this issue, as well as the complexity required to fix it for old versions, we relied on impacted people discovering the workaround on the GitHub issue."}),"\n",(0,s.jsx)(t.p,{children:"It took us 48 hours to recognize the larger scope of this issue and that we couldn\u2019t rely on everyone finding the GitHub issue. We needed to prioritize more complex active mitigations to automatically fix people\u2019s projects."}),"\n",(0,s.jsx)(t.p,{children:"We will be revisiting our processes for when to rely on developer-applied-workarounds vs fixes that we can deploy automatically. We will also take a look at our options for getting a better live pulse on the health of our ecosystem."}),"\n",(0,s.jsx)(t.h3,{id:"release-support-policy",children:"Release Support Policy"}),"\n",(0,s.jsxs)(t.p,{children:["As visualized in the ",(0,s.jsx)(t.a,{href:"https://rn-versions.github.io/",children:"rn-versions tool"}),", to cover more than 90% of the developer base of React Native at the time of the incident, we had to release patches all the way down to version 0.63."]}),"\n",(0,s.jsx)(t.p,{children:"We believe this is caused by the React Native upgrade experience which has historically been full of frictions. We are currently looking into ways to improve the upgrade experience to make it smoother and faster to mitigate this fragmentation of the ecosystem."}),"\n",(0,s.jsx)(t.p,{children:"Releasing a newer version of React Native should never have an impact on users on older versions, and we want to apologize for the disruption we caused to your workflow."}),"\n",(0,s.jsxs)(t.p,{children:["Similarly, we want to also stress the importance of being up to date with the latest version of your dependencies and React Native to benefit from the improvements and the safeguards we introduced. This incident happened during a time in which an official ",(0,s.jsx)(t.a,{href:"https://github.com/reactwg/react-native-releases#releases-support-policy",children:"release support policy"})," was getting defined and wasn\u2019t broadcasted or enforced yet."]}),"\n",(0,s.jsxs)(t.p,{children:["In the future, we will communicate our support policy over our communication channels and we will consider ",(0,s.jsx)(t.a,{href:"https://docs.npmjs.com/deprecating-and-undeprecating-packages-or-package-versions",children:"deprecating older versions of React Native on npm"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"improved-testing-and-best-practices-for-3rd-party-libraries",children:"Improved testing and best practices for 3rd party libraries"}),"\n",(0,s.jsx)(t.p,{children:"This incident highlighted the importance of having better release testing and better guidance to 3rd party libraries."}),"\n",(0,s.jsxs)(t.p,{children:["On the testing side, releasing versions down to ",(0,s.jsx)(t.code,{children:"0.63.x"})," proved to be challenging due to the lack of automation and testing we now have in place for stable releases. We recognize the importance of our release and testing infrastructure and we\u2019re going to invest further in it in the future."]}),"\n",(0,s.jsxs)(t.p,{children:["Specifically, we are now encouraging and supporting 3rd party library testing as part of the ",(0,s.jsx)(t.a,{href:"https://github.com/reactwg/react-native-releases/discussions/41",children:"release of react native"}),". We\u2019re also adding some new channels and roles in the ",(0,s.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/ECOSYSTEM.md#core-contributors",children:"Core Contributors Discord Server"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["On top of this, we started a closer collaboration with Callstack, the maintainers of ",(0,s.jsx)(t.a,{href:"https://github.com/callstack/react-native-builder-bob/tree/main/packages/create-react-native-library",children:"create-react-native-library"}),", to improve the library template and make sure it follows all the necessary best practices to integrate with React Native projects. The newer version of ",(0,s.jsx)(t.code,{children:"create-react-native-library"})," is now fully compatible with 0.71 projects while still offering backward compatibility."]}),"\n",(0,s.jsx)(t.h1,{id:"conclusions",children:"Conclusions"}),"\n",(0,s.jsx)(t.p,{children:"We want to apologize for the disruption this caused to the workflows of developers all around the world. As highlighted above, we have already started taking action to strengthen our foundation - and more work is due."}),"\n",(0,s.jsx)(t.p,{children:"We hope that sharing these insights will help you all better understand this incident, and that you can leverage our learnings to apply better practices in your own tools and projects."}),"\n",(0,s.jsx)(t.p,{children:"In closing, we want once again to thank Sonatype for helping us remove the artifacts, our community, and the release crew that worked tirelessly to address this as soon as possible."})]})}const h=function(e={}){const{wrapper:t}=Object.assign({},(0,a.ah)(),e.components);return t?(0,s.jsx)(t,Object.assign({},e,{children:(0,s.jsx)(d,e)})):d(e)}},71426:(e,t,i)=>{var s=i(27378),a=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,i){var s,n={},l=null,d=null;for(s in void 0!==i&&(l=""+i),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)r.call(t,s)&&!c.hasOwnProperty(s)&&(n[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===n[s]&&(n[s]=t[s]);return{$$typeof:a,type:e,key:l,ref:d,props:n,_owner:o.current}}t.Fragment=n,t.jsx=l,t.jsxs=l},24246:(e,t,i)=>{e.exports=i(71426)},71670:(e,t,i)=>{i.d(t,{Zo:()=>o,ah:()=>n});var s=i(27378);const a=s.createContext({});function n(e){const t=s.useContext(a);return s.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const r={};function o({components:e,children:t,disableParentContext:i}){let o;return o=i?"function"==typeof e?e({}):e||r:n(e),s.createElement(a.Provider,{value:o},t)}}}]);