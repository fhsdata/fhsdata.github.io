/*! For license information please see c45ac2b7.02ccc185.js.LICENSE.txt */
"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[43392],{42090:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var n=s(24246),i=s(71670);const o={title:"How to Run and Write Tests"},r=void 0,a={id:"how-to-run-and-write-tests",title:"How to Run and Write Tests",description:"Running Tests",source:"@site/contributing/how-to-run-and-write-tests.md",sourceDirName:".",slug:"/how-to-run-and-write-tests",permalink:"/contributing/how-to-run-and-write-tests",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/react-native-website/blob/main/website/contributing/how-to-run-and-write-tests.md",tags:[],version:"current",lastUpdatedAt:1706025541,formattedLastUpdatedAt:"Jan 23, 2024",frontMatter:{title:"How to Run and Write Tests"},sidebar:"contributing",previous:{title:"How to Build from Source",permalink:"/contributing/how-to-build-from-source"},next:{title:"How to Open a Pull Request",permalink:"/contributing/how-to-open-a-pull-request"}},c={},d=[{value:"Running Tests",id:"running-tests",level:2},{value:"JavaScript Tests",id:"javascript-tests",level:3},{value:"iOS Tests",id:"ios-tests",level:3},{value:"iOS Podfile/Ruby tests",id:"ios-podfileruby-tests",level:4},{value:"Android Tests",id:"android-tests",level:3},{value:"Writing Tests",id:"writing-tests",level:2},{value:"JavaScript Tests",id:"javascript-tests-1",level:3},{value:"iOS Integration Tests",id:"ios-integration-tests",level:3},{value:"iOS Snapshot Tests",id:"ios-snapshot-tests",level:3},{value:"Android Unit Tests",id:"android-unit-tests",level:3},{value:"Continuous Testing",id:"continuous-testing",level:2},{value:"F.A.Q.",id:"faq",level:3},{value:"How do I upgrade the Xcode version used in CI tests?",id:"how-do-i-upgrade-the-xcode-version-used-in-ci-tests",level:4}];function l(e){const t=Object.assign({h2:"h2",p:"p",a:"a",h3:"h3",pre:"pre",code:"code",admonition:"admonition",h4:"h4",ul:"ul",li:"li",strong:"strong"},(0,i.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"running-tests",children:"Running Tests"}),"\n",(0,n.jsxs)(t.p,{children:["This section is about testing your changes to React Native as a contributor. If you haven't yet, go through the steps to set up your development environment for ",(0,n.jsx)(t.a,{href:"/docs/environment-setup",children:"building projects with native code"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"javascript-tests",children:"JavaScript Tests"}),"\n",(0,n.jsx)(t.p,{children:"The simplest way to run the JavaScript test suite is by using the following command at the root of your React Native checkout:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"yarn test\n"})}),"\n",(0,n.jsxs)(t.p,{children:["This will run tests using ",(0,n.jsx)(t.a,{href:"https://jestjs.io",children:"Jest"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["You should also make sure your code passes ",(0,n.jsx)(t.a,{href:"https://flowtype.org/",children:"Flow"})," and lint tests:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"yarn flow\nyarn lint\n"})}),"\n",(0,n.jsx)(t.h3,{id:"ios-tests",children:"iOS Tests"}),"\n",(0,n.jsxs)(t.p,{children:["Follow the ",(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/packages/rn-tester/README.md",children:"README.md"})," instructions in the ",(0,n.jsx)(t.code,{children:"packages/rn-tester"})," directory."]}),"\n",(0,n.jsxs)(t.p,{children:["Then, go back to the root of your React Native checkout and run ",(0,n.jsx)(t.code,{children:"yarn"}),". This will set up your JavaScript dependencies."]}),"\n",(0,n.jsx)(t.p,{children:"At this point, you can run iOS tests by invoking the following script from the root of your React Native checkout:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"./scripts/objc-test.sh test\n"})}),"\n",(0,n.jsxs)(t.p,{children:["You can also use Xcode to run iOS tests. Open ",(0,n.jsx)(t.code,{children:"RNTester/RNTesterPods.xcworkspace"})," and run tests locally by pressing ",(0,n.jsx)("kbd",{children:"Command + U"})," or selecting ",(0,n.jsx)(t.code,{children:"Product"})," then ",(0,n.jsx)(t.code,{children:"Test"})," from the menubar."]}),"\n",(0,n.jsxs)(t.p,{children:["Xcode also allows running individual tests through its Test Navigator. You can also use ",(0,n.jsx)("kbd",{children:"Command + 6"})," shortcut."]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"objc-test.sh"})," ensures your test environment is set up to run all tests. It also disables tests that are known to be flaky or broken. Keep this in mind when running tests using Xcode. If you see an unexpected failure, see if it's disabled in ",(0,n.jsx)(t.code,{children:"objc-test.sh"})," first."]})}),"\n",(0,n.jsx)(t.h4,{id:"ios-podfileruby-tests",children:"iOS Podfile/Ruby tests"}),"\n",(0,n.jsxs)(t.p,{children:["If you are making modifications to ",(0,n.jsx)(t.code,{children:"Podfile"})," configurations then there are Ruby tests that can verify these."]}),"\n",(0,n.jsx)(t.p,{children:"To run the ruby tests:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"cd scripts\nsh run_ruby_tests.sh\n"})}),"\n",(0,n.jsx)(t.h3,{id:"android-tests",children:"Android Tests"}),"\n",(0,n.jsx)(t.p,{children:"The Android Unit tests do not run in an emulator, but they run on the JVM on your local machine."}),"\n",(0,n.jsx)(t.p,{children:"To run the Android Unit tests, invoke the following script from the root of your React Native checkout:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"./gradlew test\n"})}),"\n",(0,n.jsx)(t.h2,{id:"writing-tests",children:"Writing Tests"}),"\n",(0,n.jsx)(t.p,{children:"Whenever you are fixing a bug or adding new functionality to React Native, it is a good idea to add a test that covers it. Depending on the change you're making, there are different types of tests that may be appropriate."}),"\n",(0,n.jsx)(t.h3,{id:"javascript-tests-1",children:"JavaScript Tests"}),"\n",(0,n.jsxs)(t.p,{children:["The JavaScript tests can be found inside ",(0,n.jsx)(t.code,{children:"__test__"})," directories, colocated next to the files that are being tested. See ",(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/Libraries/Components/Touchable/__tests__/TouchableHighlight-test.js",children:(0,n.jsx)(t.code,{children:"TouchableHighlight-test.js"})})," for a basic example. You can also follow Jest's ",(0,n.jsx)(t.a,{href:"https://jestjs.io/docs/en/tutorial-react-native",children:"Testing React Native Apps"})," tutorial to learn more."]}),"\n",(0,n.jsx)(t.h3,{id:"ios-integration-tests",children:"iOS Integration Tests"}),"\n",(0,n.jsx)(t.p,{children:"React Native provides facilities to make it easier to test integrated components that require both native and JS components to communicate across the bridge."}),"\n",(0,n.jsxs)(t.p,{children:["The two main components are ",(0,n.jsx)(t.code,{children:"RCTTestRunner"})," and ",(0,n.jsx)(t.code,{children:"RCTTestModule"}),". ",(0,n.jsx)(t.code,{children:"RCTTestRunner"})," sets up the React Native environment and provides facilities to run the tests as ",(0,n.jsx)(t.code,{children:"XCTestCase"}),"s in Xcode (",(0,n.jsx)(t.code,{children:"runTest:module"})," is the simplest method). ",(0,n.jsx)(t.code,{children:"RCTTestModule"})," is exported to JavaScript as ",(0,n.jsx)(t.code,{children:"NativeModules.TestModule"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["The tests themselves are written in JS, and must call ",(0,n.jsx)(t.code,{children:"TestModule.markTestCompleted()"})," when they are done, otherwise the test will timeout and fail."]}),"\n",(0,n.jsxs)(t.p,{children:["Test failures are primarily indicated by throwing a JS exception. It is also possible to test error conditions with ",(0,n.jsx)(t.code,{children:"runTest:module:initialProps:expectErrorRegex:"})," or ",(0,n.jsx)(t.code,{children:"runTest:module:initialProps:expectErrorBlock:"})," which will expect an error to be thrown and verify the error matches the provided criteria."]}),"\n",(0,n.jsx)(t.p,{children:"See the following for example usage and integration points:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/IntegrationTests/IntegrationTestHarnessTest.js",children:(0,n.jsx)(t.code,{children:"IntegrationTestHarnessTest.js"})})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/RNTester/RNTesterIntegrationTests/RNTesterIntegrationTests.m",children:(0,n.jsx)(t.code,{children:"RNTesterIntegrationTests.m"})})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/IntegrationTests/IntegrationTestsApp.js",children:(0,n.jsx)(t.code,{children:"IntegrationTestsApp.js"})})}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"ios-snapshot-tests",children:"iOS Snapshot Tests"}),"\n",(0,n.jsxs)(t.p,{children:["A common type of integration test is the snapshot test. These tests render a component, and verify snapshots of the screen against reference images using ",(0,n.jsx)(t.code,{children:"TestModule.verifySnapshot()"}),", using the ",(0,n.jsx)(t.a,{href:"https://github.com/facebook/ios-snapshot-test-case",children:(0,n.jsx)(t.code,{children:"FBSnapshotTestCase"})})," library behind the scenes. Reference images are recorded by setting ",(0,n.jsx)(t.code,{children:"recordMode = YES"})," on the ",(0,n.jsx)(t.code,{children:"RCTTestRunner"}),", then running the tests."]}),"\n",(0,n.jsxs)(t.p,{children:["Snapshots will differ slightly between 32 and 64 bit, and various OS versions, so it's recommended that you enforce tests are run with the ",(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/scripts/.tests.env",children:"correct configuration"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["It's also highly recommended that all network data be mocked out, along with other potentially troublesome dependencies. See ",(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/IntegrationTests/SimpleSnapshotTest.js",children:(0,n.jsx)(t.code,{children:"SimpleSnapshotTest"})})," for a basic example."]}),"\n",(0,n.jsx)(t.p,{children:"If you make a change that affects a snapshot test in a pull request, such as adding a new example case to one of the examples that is snapshotted, you'll need to re-record the snapshot reference image."}),"\n",(0,n.jsxs)(t.p,{children:["To do this, change ",(0,n.jsx)(t.code,{children:"recordMode"})," flag to ",(0,n.jsx)(t.code,{children:"_runner.recordMode = YES;"})," in ",(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/136666e2e7d2bb8d3d51d599fc1384a2f68c43d3/RNTester/RNTesterIntegrationTests/RNTesterSnapshotTests.m#L29",children:"RNTester/RNTesterSnapshotTests.m"}),", re-run the failing tests, then flip record back to ",(0,n.jsx)(t.code,{children:"NO"})," and submit/update your pull request and wait to see if the CircleCI build passes."]}),"\n",(0,n.jsx)(t.h3,{id:"android-unit-tests",children:"Android Unit Tests"}),"\n",(0,n.jsxs)(t.p,{children:["It's a good idea to add an Android unit test whenever you are working on code that can be tested by Java/Kotlin code alone. The Android unit tests are located in ",(0,n.jsx)(t.code,{children:"packages/react-native/ReactAndroid/src/test/"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"We recommend browsing through these to get an idea of what a good unit test might look like."}),"\n",(0,n.jsx)(t.h2,{id:"continuous-testing",children:"Continuous Testing"}),"\n",(0,n.jsxs)(t.p,{children:["We use ",(0,n.jsx)(t.a,{href:"https://github.com/facebook/react-native/blob/main/.circleci/config.yml",children:"CircleCI"})," to automatically run our open source tests. CircleCI will run these tests whenever a commit is added to a pull request, as a way to help maintainers understand whether a code change introduces a regression. The tests also run on commits to the ",(0,n.jsx)(t.code,{children:"main"})," and ",(0,n.jsx)(t.code,{children:"*-stable"})," branches in order to keep track of the health of these branches."]}),"\n",(0,n.jsx)(t.p,{children:"There's another set of tests that run within Meta's internal test infrastructure. Some of these tests are integration tests defined by internal consumers of React Native (e.g. unit tests for a React Native surface in the Facebook app)."}),"\n",(0,n.jsx)(t.p,{children:"These tests run on every commit to the copy of React Native hosted on Facebook's source control. They also run when a pull request is imported to Facebook's source control."}),"\n",(0,n.jsx)(t.p,{children:"If one of these tests fail, you'll need someone at Meta to take a look. Since pull requests can only be imported by Meta employees, whoever imported the pull request should be able to facilitate any details."}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Running CI tests locally:"}),"\nMost open source collaborators rely on CircleCI to see the results of these tests. If you'd rather verify your changes locally using the same configuration as CircleCI, CircleCI provides a ",(0,n.jsx)(t.a,{href:"https://circleci.com/docs/local-cli",children:"command line interface"})," with the ability to run jobs locally."]})}),"\n",(0,n.jsx)(t.h3,{id:"faq",children:"F.A.Q."}),"\n",(0,n.jsx)(t.h4,{id:"how-do-i-upgrade-the-xcode-version-used-in-ci-tests",children:"How do I upgrade the Xcode version used in CI tests?"}),"\n",(0,n.jsxs)(t.p,{children:["When upgrading to a new version of Xcode, first make sure it is ",(0,n.jsx)(t.a,{href:"https://circleci.com/docs/testing-ios#supported-xcode-versions",children:"supported by CircleCI"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"You will also need to update the test environment config to make sure tests run on an iOS Simulator that comes installed in the CircleCI machine."}),"\n",(0,n.jsxs)(t.p,{children:["This can also be found in ",(0,n.jsx)(t.a,{href:"https://circleci.com/docs/2.0/testing-ios/#supported-xcode-versions",children:"CircleCI's Xcode version reference"})," by clicking the desired version and looking under Runtimes."]}),"\n",(0,n.jsx)(t.p,{children:"You can then edit these two files:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.code,{children:".circleci/config.yml"})}),"\n",(0,n.jsxs)(t.p,{children:["Edit the ",(0,n.jsx)(t.code,{children:"xcode:"})," line under ",(0,n.jsx)(t.code,{children:"macos:"})," (search for ",(0,n.jsx)(t.code,{children:"_XCODE_VERSION"}),")."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.code,{children:"scripts/.tests.env"})}),"\n",(0,n.jsxs)(t.p,{children:["Edit the ",(0,n.jsx)(t.code,{children:"IOS_TARGET_OS"})," envvar to match the desired iOS Runtime."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["If you intend to merge this change on GitHub, please make sure to notify a Meta employee as they'll need to update the value of ",(0,n.jsx)(t.code,{children:"_XCODE_VERSION"})," used in the internal Sandcastle RN OSS iOS test in ",(0,n.jsx)(t.code,{children:"react_native_oss.py"})," when they import your pull request."]})]})}const h=function(e={}){const{wrapper:t}=Object.assign({},(0,i.ah)(),e.components);return t?(0,n.jsx)(t,Object.assign({},e,{children:(0,n.jsx)(l,e)})):l(e)}},71426:(e,t,s)=>{var n=s(27378),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,s){var n,o={},d=null,l=null;for(n in void 0!==s&&(d=""+s),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)r.call(t,n)&&!c.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:i,type:e,key:d,ref:l,props:o,_owner:a.current}}t.Fragment=o,t.jsx=d,t.jsxs=d},24246:(e,t,s)=>{e.exports=s(71426)},71670:(e,t,s)=>{s.d(t,{Zo:()=>a,ah:()=>o});var n=s(27378);const i=n.createContext({});function o(e){const t=n.useContext(i);return n.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const r={};function a({components:e,children:t,disableParentContext:s}){let a;return a=s?"function"==typeof e?e({}):e||r:o(e),n.createElement(i.Provider,{value:a},t)}}}]);